import{r as a,dI as R,U as _,$ as j,dJ as F,aC as b}from"./index.2a0d7abb.js";import{v}from"./normalizeUtils.bb2a1204.js";import{t as w}from"./pbfQueryUtils.7af60b23.js";import"./pbf.82af97e2.js";import"./OptimizedGeometry.8186c50d.js";import"./OptimizedFeatureSet.2574e09f.js";var q=Object.defineProperty,J=Object.defineProperties,N=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable,m=(r,t,n)=>t in r?q(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n,l=(r,t)=>{for(var n in t||(t={}))h.call(t,n)&&m(r,n,t[n]);if(p)for(var n of p(t))z.call(t,n)&&m(r,n,t[n]);return r},S=(r,t)=>J(r,N(t));function O(r){const t={};for(const n in r){if(n==="declaredClass")continue;const e=r[n];if(e!=null&&typeof e!="function")if(Array.isArray(e)){t[n]=[];for(let o=0;o<e.length;o++)t[n][o]=O(e[o])}else typeof e=="object"?e.toJSON&&(t[n]=JSON.stringify(e)):t[n]=e}return t}const x="Layer does not support extent calculation.";function g(r,t){if(t&&r.type==="extent")return`${r.xmin},${r.ymin},${r.xmax},${r.ymax}`;if(t&&r.type==="point")return`${r.x},${r.y}`;const n=r.toJSON();return delete n.spatialReference,JSON.stringify(n)}function E(r,t){const n=r.geometry,e=r.toJSON();delete e.compactGeometryEnabled,delete e.defaultSpatialReferenceEnabled;const o=e,i=r.outSpatialReference;let u,y;if(a(n)&&(u=n.spatialReference,y=n.spatialReference.wkid||JSON.stringify(n.spatialReference),o.geometryType=b(n),o.geometry=g(n,r.compactGeometryEnabled),o.inSR=y),e.groupByFieldsForStatistics&&(o.groupByFieldsForStatistics=e.groupByFieldsForStatistics.join(",")),e.objectIds&&(o.objectIds=e.objectIds.join(",")),e.orderByFields&&(o.orderByFields=e.orderByFields.join(",")),!e.outFields||!e.returnDistinctValues&&(t!=null&&t.returnCountOnly||t!=null&&t.returnExtentOnly||t!=null&&t.returnIdsOnly)?delete o.outFields:e.outFields.indexOf("*")!==-1?o.outFields="*":o.outFields=e.outFields.join(","),e.outSR?o.outSR=e.outSR.wkid||JSON.stringify(e.outSR):n&&(e.returnGeometry||e.returnCentroid)&&(o.outSR=o.inSR),e.returnGeometry&&delete e.returnGeometry,e.outStatistics&&(o.outStatistics=JSON.stringify(e.outStatistics)),e.pixelSize&&(o.pixelSize=JSON.stringify(e.pixelSize)),e.quantizationParameters&&(r.defaultSpatialReferenceEnabled&&a(u)&&a(r.quantizationParameters)&&a(r.quantizationParameters.extent)&&u.equals(r.quantizationParameters.extent.spatialReference)&&delete e.quantizationParameters.extent.spatialReference,o.quantizationParameters=JSON.stringify(e.quantizationParameters)),e.parameterValues&&(o.parameterValues=JSON.stringify(e.parameterValues)),e.rangeValues&&(o.rangeValues=JSON.stringify(e.rangeValues)),e.dynamicDataSource&&(o.layer=JSON.stringify({source:e.dynamicDataSource}),delete e.dynamicDataSource),e.timeExtent){const f=e.timeExtent,{start:s,end:d}=f;s==null&&d==null||(o.time=s===d?s:`${s==null?"null":s},${d==null?"null":d}`),delete e.timeExtent}return r.defaultSpatialReferenceEnabled&&a(u)&&a(i)&&u.equals(i)&&(o.defaultSR=o.inSR,delete o.inSR,delete o.outSR),o}async function I(r,t,n,e){const o=a(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await c(r,t,"json",e);return R(t,n,o.data),o}async function B(r,t,n,e){if(a(t.timeExtent)&&t.timeExtent.isEmpty)return Promise.resolve({data:n.createFeatureResult()});const o=await P(r,t,e),i=o;return i.data=w(o.data,n),i}function P(r,t,n){return c(r,t,"pbf",n)}function C(r,t,n){return a(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):c(r,t,"json",n,{returnIdsOnly:!0})}function Q(r,t,n){return a(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):c(r,t,"json",n,{returnIdsOnly:!0,returnCountOnly:!0})}function V(r,t,n){return a(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):c(r,t,"json",n,{returnExtentOnly:!0,returnCountOnly:!0}).then(e=>{const o=e.data;if(o.hasOwnProperty("extent"))return e;if(o.features)throw new Error(x);if(o.hasOwnProperty("count"))throw new Error(x);return e})}function c(r,t,n,e={},o={}){const i=typeof r=="string"?_(r):r,u=t.geometry?[t.geometry]:[];return e.responseType=n==="pbf"?"array-buffer":"json",v(u,null,e).then(y=>{const f=y&&y[0];a(f)&&((t=t.clone()).geometry=f);const s=O(l(l(S(l({},i.query),{f:n}),o),E(t,o)));return j(F(i.path,"query"),S(l({},e),{query:l(l({},s),e.query)}))})}var U=Object.freeze(Object.defineProperty({__proto__:null,encodeGeometry:g,executeQuery:I,executeQueryForCount:Q,executeQueryForExtent:V,executeQueryForIds:C,executeQueryPBF:B,executeQueryPBFBuffer:P,queryToQueryStringParameters:E,runQuery:c},Symbol.toStringTag,{value:"Module"}));export{Q as S,I as c,B as d,P as f,C as p,U as q,O as t,V as x};
